<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lazarus Stressmodell Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .active-stage {
            border-color: #3b82f6;
            background-color: #eff6ff;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 h-[100dvh] flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 p-4 flex justify-between items-center shadow-sm z-20 relative">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold shrink-0">L</div>
            <h1 class="text-xl font-bold text-slate-800 hidden sm:block">Transaktionales Stressmodell <span class="text-slate-400 font-normal">| Lazarus & Folkman</span></h1>
            <h1 class="text-lg font-bold text-slate-800 sm:hidden">Stressmodell Trainer</h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="bg-slate-100 px-3 py-1 md:px-4 md:py-2 rounded-full font-semibold text-sm whitespace-nowrap">
                Score: <span id="score-display" class="text-blue-600">0</span>
            </div>
            <button onclick="app.resetGame()" class="text-slate-500 hover:text-red-500 transition"><i class="fas fa-redo"></i> <span class="hidden sm:inline">Neustart</span></button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col md:flex-row h-full overflow-hidden relative">
        
        <!-- Left Panel: Visualization (The Model) -->
        <div class="w-full md:w-1/3 bg-white border-r border-slate-200 p-6 flex flex-col hidden md:flex z-10 relative">
            <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-6 shrink-0">Modell-Status</h3>
            
            <div class="flex-1 flex flex-col items-center justify-start gap-6 w-full max-w-xs mx-auto relative z-10 overflow-y-auto pb-6">
                <!-- Step 0: Stressor -->
                <div id="vis-stressor" class="w-full p-3 border-2 border-slate-200 rounded-xl text-center transition-all duration-300 bg-white shrink-0">
                    <div class="text-xl mb-1">⚡</div>
                    <div class="font-bold text-sm">Stressor</div>
                </div>

                <div class="h-4 w-0.5 bg-slate-300 shrink-0"></div>

                <!-- Step 1: Primary Appraisal -->
                <div id="vis-primary" class="w-full p-3 border-2 border-slate-200 rounded-xl text-center transition-all duration-300 bg-white shrink-0">
                    <div class="font-bold text-xs uppercase text-slate-500 mb-1">Schritt 1</div>
                    <div class="font-bold text-sm">Primäre Bewertung</div>
                    <div class="text-[10px] text-slate-500">Bedrohlich?</div>
                </div>

                <div class="h-4 w-0.5 bg-slate-300 shrink-0"></div>

                <!-- Step 2: Secondary Appraisal -->
                <div id="vis-secondary" class="w-full p-3 border-2 border-slate-200 rounded-xl text-center transition-all duration-300 bg-white shrink-0">
                    <div class="font-bold text-xs uppercase text-slate-500 mb-1">Schritt 2</div>
                    <div class="font-bold text-sm">Sekundäre Bewertung</div>
                    <div class="text-[10px] text-slate-500">Ressourcen?</div>
                </div>

                <div class="h-4 w-0.5 bg-slate-300 shrink-0"></div>

                <!-- Step 3: Coping -->
                <div id="vis-coping" class="w-full p-3 border-2 border-slate-200 rounded-xl text-center transition-all duration-300 bg-white shrink-0">
                    <div class="font-bold text-xs uppercase text-slate-500 mb-1">Schritt 3</div>
                    <div class="font-bold text-sm">Coping</div>
                    <div class="text-[10px] text-slate-500">Handlung</div>
                </div>

                <div class="h-4 w-0.5 bg-slate-300 shrink-0"></div>

                <!-- Step 4: Reappraisal (NEW) -->
                <div id="vis-reappraisal" class="w-full p-3 border-2 border-slate-200 rounded-xl text-center transition-all duration-300 bg-white shrink-0">
                    <div class="font-bold text-xs uppercase text-slate-500 mb-1">Schritt 4</div>
                    <div class="font-bold text-sm">Neubewertung</div>
                    <div class="text-[10px] text-slate-500">Reappraisal</div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Interaction Area -->
        <div class="w-full md:w-2/3 bg-slate-50 overflow-y-auto relative scroll-smooth">
            
            <!-- Wrapper for safe centering and mobile padding -->
            <div class="min-h-full w-full flex flex-col items-center justify-center p-4 md:p-12 pb-32">

                <!-- Welcome Screen -->
                <div id="screen-welcome" class="max-w-2xl text-center fade-in w-full">
                    <div class="mb-6 inline-block p-4 bg-blue-100 rounded-full text-blue-600 text-4xl">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-4 text-slate-800">Willkommen im Stress-Labor</h2>
                    <p class="text-base md:text-lg text-slate-600 mb-8 leading-relaxed">
                        Trainieren Sie Ihr Verständnis des transaktionalen Stressmodells nach Lazarus. 
                        Analysieren Sie die Szenarien Schritt für Schritt anhand standardisierter Kategorien.
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4 mb-8 text-left">
                        <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                            <div class="font-bold text-blue-600 text-xs md:text-sm">1. Primär</div>
                            <p class="text-[10px] md:text-xs text-slate-500">Gefahr?</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                            <div class="font-bold text-blue-600 text-xs md:text-sm">2. Sekundär</div>
                            <p class="text-[10px] md:text-xs text-slate-500">Ressourcen?</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                            <div class="font-bold text-blue-600 text-xs md:text-sm">3. Coping</div>
                            <p class="text-[10px] md:text-xs text-slate-500">Handlung</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm border border-slate-200">
                            <div class="font-bold text-blue-600 text-xs md:text-sm">4. Neubewertung</div>
                            <p class="text-[10px] md:text-xs text-slate-500">Fazit</p>
                        </div>
                    </div>
                    <button onclick="app.startGame()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-full shadow-lg transition transform hover:scale-105 w-full md:w-auto text-lg">
                        Training starten
                    </button>
                </div>

                <!-- Game Container -->
                <div id="screen-game" class="w-full max-w-3xl hidden fade-in">
                    
                    <!-- Scenario Card -->
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-200 p-5 md:p-6 mb-6 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-2 h-full bg-blue-500"></div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-bold tracking-wider text-blue-600 uppercase">Fallbeispiel <span id="scenario-count">1</span>/5</span>
                            <span class="text-xs font-bold text-slate-400" id="scenario-topic">Thema</span>
                        </div>
                        <h3 class="text-xl md:text-2xl font-bold text-slate-800 mb-3" id="scenario-title">Titel</h3>
                        <p class="text-slate-600 text-base md:text-lg leading-relaxed" id="scenario-desc">Beschreibung...</p>
                        
                        <!-- Character Thought Bubble (Dynamic) -->
                        <div class="mt-6 bg-slate-50 border border-slate-200 p-4 rounded-xl rounded-tl-none relative ml-4">
                            <div class="absolute -top-3 -left-1 w-4 h-4 bg-slate-50 border-l border-t border-slate-200 transform -rotate-45"></div>
                            <p class="text-slate-700 italic flex gap-3 text-sm md:text-base">
                                <i class="fas fa-quote-left text-slate-300"></i>
                                <span id="scenario-thought" class="font-medium">...</span>
                            </p>
                        </div>
                    </div>

                    <!-- Question Area -->
                    <div id="question-area" class="bg-white rounded-xl shadow-md border border-slate-200 p-5 md:p-6 mb-20 md:mb-0">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            <i class="far fa-question-circle text-blue-500"></i>
                            <span id="question-text">Frage...</span>
                        </h4>
                        
                        <div id="options-container" class="grid grid-cols-1 gap-3">
                            <!-- Options injected via JS -->
                        </div>

                        <!-- Feedback Area (Hidden initially) -->
                        <div id="feedback-area" class="hidden mt-6 p-4 rounded-lg bg-slate-50 border">
                            <div class="flex gap-3 mb-2">
                                <div id="feedback-icon" class="text-2xl"></div>
                                <div>
                                    <h5 id="feedback-title" class="font-bold text-lg"></h5>
                                    <p id="feedback-text" class="text-slate-600 text-sm md:text-base"></p>
                                </div>
                            </div>
                            <button onclick="app.nextStep()" class="mt-4 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition w-full shadow-md font-bold text-lg">Weiter</button>
                        </div>
                    </div>
                </div>

                <!-- End Screen -->
                <div id="screen-end" class="max-w-xl text-center hidden fade-in w-full">
                    <div class="mb-6">
                        <i class="fas fa-trophy text-yellow-400 text-6xl drop-shadow-sm"></i>
                    </div>
                    <h2 class="text-3xl font-bold mb-2">Training abgeschlossen!</h2>
                    <p class="text-slate-600 mb-6">Sie haben das transaktionale Stressmodell erfolgreich angewendet.</p>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 mb-8">
                        <div class="text-sm text-slate-500 uppercase tracking-wide font-bold mb-1">Ihr Ergebnis</div>
                        <div class="text-5xl font-bold text-blue-600 mb-2"><span id="final-score">0</span> <span class="text-2xl text-slate-400">Punkte</span></div>
                        <p id="final-feedback" class="text-slate-600">Feedback Text...</p>
                    </div>

                    <button onclick="app.resetGame()" class="bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-8 rounded-full shadow-lg transition">
                        Erneut trainieren
                    </button>
                </div>

            </div>
        </div>
    </main>

    <script>
        const appData = [
            {
                id: 1,
                topic: "Klausurphase (Standard)",
                title: "Der Klassiker",
                desc: "Prof. Müller kündigt kurz vor knapp neuen Stoff an.",
                thought: "Das schaffe ich niemals in der Zeit. Wenn ich durchfalle, verliere ich mein Stipendium!",
                steps: [
                    {
                        type: "primary",
                        question: "Schritt 1: Primäre Bewertung der Situation.",
                        options: [
                            { text: "Bedrohung/Verlust", correct: true, feedback: "Richtig. Die Antizipation des Stipendienverlusts ist eine Bedrohung." },
                            { text: "Herausforderung", correct: false, feedback: "Die Panik ('niemals') spricht gegen eine positive Herausforderung." },
                            { text: "Irrelevant", correct: false, feedback: "Es hat direkte Konsequenzen, ist also nicht irrelevant." }
                        ]
                    },
                    {
                        type: "secondary",
                        question: "Schritt 2: Sekundäre Bewertung (Ressourcen-Check).",
                        options: [
                            { text: "Ressourcen < Anforderung", correct: true, feedback: "Korrekt. Die Anforderungen übersteigen die wahrgenommenen Fähigkeiten ('schaffe ich nie')." },
                            { text: "Ressourcen > Anforderung", correct: false, feedback: "Er fühlt sich den Anforderungen nicht gewachsen." }
                        ]
                    },
                    {
                        type: "coping",
                        question: "Schritt 3: Coping. Er bittet den Prof um Eingrenzung.",
                        options: [
                            { text: "Problemorientiert", correct: true, feedback: "Richtig, er versucht die Situation aktiv zu ändern." },
                            { text: "Emotionsorientiert", correct: false, feedback: "Er ändert nicht nur sein Gefühl, sondern die Anforderung selbst." }
                        ]
                    },
                    {
                        type: "reappraisal",
                        question: "Schritt 4: Neubewertung. Der Prof stimmt zu.",
                        options: [
                            { text: "Herausforderung", correct: true, feedback: "Richtig. Die Aufgabe ist nun machbar und wird zur Herausforderung." },
                            { text: "Bedrohung/Verlust", correct: false, feedback: "Die akute Gefahr ist durch die Eingrenzung gebannt." },
                            { text: "Irrelevant", correct: false, feedback: "Die Klausur ist weiterhin wichtig." }
                        ]
                    }
                ]
            },
            {
                id: 2,
                topic: "Datenverlust (Ausreichende Ressourcen)",
                title: "Der Laptop-Crash",
                desc: "Drei Tage vor Abgabe der Hausarbeit stürzt dein Laptop ab und lässt sich nicht mehr starten.",
                thought: "Scheiße! Meine Arbeit! ... Warte, ich habe gestern Abend ein Backup gemacht.",
                steps: [
                    {
                        type: "primary",
                        question: "Schritt 1: Primäre Bewertung des ersten Schocks.",
                        options: [
                            { text: "Bedrohung/Verlust", correct: true, feedback: "Genau. Im ersten Moment wird ein Verlust antizipiert." },
                            { text: "Herausforderung", correct: false, feedback: "Dies ist keine positive Challenge." },
                            { text: "Irrelevant", correct: false, feedback: "Die Arbeit ist wichtig." }
                        ]
                    },
                    {
                        type: "secondary",
                        question: "Schritt 2: Sekundäre Bewertung (Ressourcen-Check mit Backup).",
                        options: [
                            { text: "Ressourcen > Anforderung", correct: true, feedback: "Richtig. Das Backup (Ressource) löst das Problem vollständig. Coping und Neubewertung entfallen, da der Stressor neutralisiert ist." },
                            { text: "Ressourcen < Anforderung", correct: false, feedback: "Das Backup ist vorhanden und funktional." }
                        ]
                    }
                ]
            },
            {
                id: 3,
                topic: "WG-Leben (Dysfunktional)",
                title: "Der Abwasch-Streit",
                desc: "Die Küche ist dreckig. Du bist gestresst wegen einer Klausur.",
                thought: "Das nervt mich tierisch! Ich kann mich jetzt nicht damit befassen. Ich trinke erst mal ein Bier, um runterzukommen.",
                steps: [
                    {
                        type: "primary",
                        question: "Schritt 1: Primäre Bewertung der schmutzigen Küche.",
                        options: [
                            { text: "Bedrohung/Verlust", correct: true, feedback: "Ja, im Sinne eines 'Daily Hassle', der das Wohlbefinden bedroht." },
                            { text: "Irrelevant", correct: false, feedback: "Wer genervt ist, dem ist es nicht egal." },
                            { text: "Herausforderung", correct: false, feedback: "Es wird nicht als positive Aufgabe gesehen." }
                        ]
                    },
                    {
                        type: "secondary",
                        question: "Schritt 2: Sekundäre Bewertung der zeitlichen Ressourcen.",
                        options: [
                            { text: "Ressourcen < Anforderung", correct: true, feedback: "Genau. Die Ressource 'Zeit/Energie' fehlt für den Konflikt." },
                            { text: "Ressourcen > Anforderung", correct: false, feedback: "Er hat keine Kapazität dafür." }
                        ]
                    },
                    {
                        type: "coping",
                        question: "Schritt 3: Coping (Bier trinken / Vermeidung).",
                        options: [
                            { text: "Emotionsorientiert", correct: true, feedback: "Richtig. Vermeidung und Substanzkonsum regulieren nur das Gefühl, nicht das Problem." },
                            { text: "Problemorientiert", correct: false, feedback: "Die Küche bleibt dreckig." }
                        ]
                    },
                    {
                        type: "reappraisal",
                        question: "Schritt 4: Neubewertung am nächsten Morgen (Küche immer noch dreckig).",
                        options: [
                            { text: "Bedrohung/Verlust", correct: true, feedback: "Korrekt. Das Problem wurde nicht gelöst, der Stressor besteht fort." },
                            { text: "Irrelevant", correct: false, feedback: "Es stört immer noch." },
                            { text: "Herausforderung", correct: false, feedback: "Es ist immer noch keine positive Aufgabe." }
                        ]
                    }
                ]
            },
            {
                id: 4,
                topic: "Lernen (Sozial)",
                title: "Das komplexe Paper",
                desc: "Du verstehst den Text nicht und fühlst dich dumm.",
                thought: "Ich bin zu dumm dafür. Das lerne ich nie! Ich ruf mal Anna an.",
                steps: [
                    {
                        type: "primary",
                        question: "Schritt 1: Primäre Bewertung.",
                        options: [
                            { text: "Bedrohung/Verlust", correct: true, feedback: "Richtig. Bedrohung des Selbstwertgefühls ('bin zu dumm')." },
                            { text: "Herausforderung", correct: false, feedback: "Er traut es sich initial nicht zu." },
                            { text: "Irrelevant", correct: false, feedback: "Er muss es lernen." }
                        ]
                    },
                    {
                        type: "secondary",
                        question: "Schritt 2: Sekundäre Bewertung (eigene Fähigkeiten).",
                        options: [
                            { text: "Ressourcen < Anforderung", correct: true, feedback: "Er glaubt, es alleine nicht zu schaffen." },
                            { text: "Ressourcen > Anforderung", correct: false, feedback: "" }
                        ]
                    },
                    {
                        type: "coping",
                        question: "Schritt 3: Coping (Hilfe suchen).",
                        options: [
                            { text: "Problemorientiert", correct: true, feedback: "Genau. Soziale Unterstützung zur Problemlösung nutzen." },
                            { text: "Emotionsorientiert", correct: false, feedback: "" }
                        ]
                    },
                    {
                        type: "reappraisal",
                        question: "Schritt 4: Neubewertung nach der Erklärung.",
                        options: [
                            { text: "Herausforderung", correct: true, feedback: "Mit der Hilfe wird die Aufgabe machbar und positiv besetzt." },
                            { text: "Bedrohung/Verlust", correct: false, feedback: "Die Angst ist gewichen." },
                            { text: "Irrelevant", correct: false, feedback: "" }
                        ]
                    }
                ]
            },
            {
                id: 5,
                topic: "Campus-News",
                title: "Die neue Prüfungsordnung",
                desc: "Ein Aushang informiert über strengere Regeln für Erstsemester. Du bist bereits im 5. Semester und hast Bestandsschutz.",
                thought: "Das ist hart für die Neuen, aber mich betrifft das zum Glück überhaupt nicht mehr.",
                steps: [
                    {
                        type: "primary",
                        question: "Schritt 1: Primäre Bewertung.",
                        options: [
                            { text: "Irrelevant", correct: true, feedback: "Richtig. Da keine eigenen Ziele bedroht sind, endet der Prozess hier ohne Stress." },
                            { text: "Bedrohung/Verlust", correct: false, feedback: "Es gibt keine negativen Konsequenzen für dich." },
                            { text: "Herausforderung", correct: false, feedback: "Es gibt keine Aufgabe zu bewältigen." }
                        ]
                    }
                ]
            }
        ];

        const app = {
            currentScenarioIndex: 0,
            currentStepIndex: 0,
            score: 0,
            
            init: function() {
                this.resetUI();
            },

            resetUI: function() {
                // Any init logic
            },

            startGame: function() {
                document.getElementById('screen-welcome').classList.add('hidden');
                document.getElementById('screen-game').classList.remove('hidden');
                document.getElementById('screen-game').classList.add('flex', 'flex-col');
                this.loadScenario(0);
            },

            resetGame: function() {
                this.currentScenarioIndex = 0;
                this.currentStepIndex = 0;
                this.score = 0;
                this.updateScore();
                document.getElementById('screen-end').classList.add('hidden');
                document.getElementById('screen-game').classList.add('hidden');
                document.getElementById('screen-welcome').classList.remove('hidden');
                this.highlightModelStage(null);
            },

            loadScenario: function(index) {
                const scenario = appData[index];
                document.getElementById('scenario-count').innerText = index + 1;
                document.getElementById('scenario-topic').innerText = scenario.topic;
                document.getElementById('scenario-title').innerText = scenario.title;
                document.getElementById('scenario-desc').innerText = scenario.desc;
                document.getElementById('scenario-thought').innerText = scenario.thought;
                
                this.currentStepIndex = 0;
                this.loadStep();
            },

            loadStep: function() {
                const scenario = appData[this.currentScenarioIndex];
                const step = scenario.steps[this.currentStepIndex];

                // Update Visual Model
                this.highlightModelStage(step.type);

                // Setup Question
                document.getElementById('question-text').innerText = step.question;
                
                // Setup Options
                const optionsContainer = document.getElementById('options-container');
                optionsContainer.innerHTML = '';
                document.getElementById('feedback-area').classList.add('hidden');
                
                // Scroll to top of game area on mobile to ensure question is visible
                // document.getElementById('screen-game').scrollIntoView({ behavior: 'smooth' });

                step.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left p-4 border border-slate-300 rounded-lg hover:bg-blue-50 hover:border-blue-300 transition flex items-center justify-between group bg-white";
                    btn.innerHTML = `<span class="font-medium text-slate-700 group-hover:text-blue-700">${opt.text}</span> <i class="fas fa-chevron-right text-slate-300 group-hover:text-blue-400"></i>`;
                    btn.onclick = () => app.checkAnswer(opt, btn);
                    optionsContainer.appendChild(btn);
                });
            },

            checkAnswer: function(option, btnElement) {
                const feedbackArea = document.getElementById('feedback-area');
                const feedbackTitle = document.getElementById('feedback-title');
                const feedbackText = document.getElementById('feedback-text');
                const feedbackIcon = document.getElementById('feedback-icon');
                
                // Disable all buttons
                const allBtns = document.getElementById('options-container').children;
                for(let btn of allBtns) {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                }

                feedbackArea.classList.remove('hidden');
                feedbackArea.classList.remove('bg-green-50', 'border-green-200', 'bg-red-50', 'border-red-200');

                if(option.correct) {
                    btnElement.classList.remove('opacity-50');
                    btnElement.classList.add('bg-green-100', 'border-green-500');
                    btnElement.querySelector('i').className = "fas fa-check text-green-600";
                    
                    feedbackArea.classList.add('bg-green-50', 'border-green-200');
                    feedbackTitle.innerText = "Korrekt!";
                    feedbackTitle.className = "font-bold text-lg text-green-700";
                    feedbackIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                    
                    this.score += 10;
                    this.updateScore();
                } else {
                    btnElement.classList.remove('opacity-50');
                    btnElement.classList.add('bg-red-100', 'border-red-500');
                    btnElement.querySelector('i').className = "fas fa-times text-red-600";
                    
                    feedbackArea.classList.add('bg-red-50', 'border-red-200');
                    feedbackTitle.innerText = "Nicht ganz...";
                    feedbackTitle.className = "font-bold text-lg text-red-700";
                    feedbackIcon.innerHTML = '<i class="fas fa-times-circle text-red-500"></i>';
                }
                
                feedbackText.innerText = option.feedback;

                // Auto scroll to feedback on mobile
                if(window.innerWidth < 768) {
                    setTimeout(() => {
                        feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'end' });
                    }, 100);
                }
            },

            nextStep: function() {
                const scenario = appData[this.currentScenarioIndex];
                
                if (this.currentStepIndex < scenario.steps.length - 1) {
                    this.currentStepIndex++;
                    this.loadStep();
                } else {
                    // Scenario finished
                    if (this.currentScenarioIndex < appData.length - 1) {
                        this.currentScenarioIndex++;
                        this.loadScenario(this.currentScenarioIndex);
                    } else {
                        this.showEndScreen();
                    }
                }
            },

            showEndScreen: function() {
                document.getElementById('screen-game').classList.add('hidden');
                document.getElementById('screen-end').classList.remove('hidden');
                document.getElementById('final-score').innerText = this.score;
                this.highlightModelStage(null);

                const finalFeedback = document.getElementById('final-feedback');
                if (this.score === (appData.reduce((acc, val) => acc + val.steps.length, 0) * 10)) {
                    finalFeedback.innerText = "Perfekt! Sie sind ein Stress-Management-Profi.";
                } else if (this.score > 20) {
                    finalFeedback.innerText = "Gute Arbeit! Sie haben das Modell weitgehend verstanden.";
                } else {
                    finalFeedback.innerText = "Das war ein guter Anfang. Versuchen Sie es noch einmal, um die Begriffe zu festigen.";
                }
            },

            updateScore: function() {
                document.getElementById('score-display').innerText = this.score;
            },

            highlightModelStage: function(type) {
                // Reset all
                ['vis-stressor', 'vis-primary', 'vis-secondary', 'vis-coping', 'vis-reappraisal'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) {
                        el.classList.remove('active-stage', 'border-blue-500');
                        el.classList.add('border-slate-200');
                    }
                });

                let activeId = '';
                if (type === 'primary') activeId = 'vis-primary';
                else if (type === 'secondary') activeId = 'vis-secondary';
                else if (type === 'coping') activeId = 'vis-coping';
                else if (type === 'reappraisal') activeId = 'vis-reappraisal';
                
                if(activeId) {
                    const el = document.getElementById(activeId);
                    if(el) {
                        el.classList.add('active-stage', 'border-blue-500');
                        el.classList.remove('border-slate-200');
                    }
                }
            }
        };

        // Initialize
        app.init();

    </script>
</body>
</html>
